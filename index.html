<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHOW Action Plan Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>CHOW Action Plan Generator</h1>
            <p class="subtitle">Change of Ownership Workflow Tool</p>
            <button class="btn-linear-settings" id="openLinearSettings">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 1a7 7 0 100 14A7 7 0 008 1zM0 8a8 8 0 1116 0A8 8 0 010 8z"/>
                    <path d="M8 4a1 1 0 011 1v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V5a1 1 0 011-1z"/>
                </svg>
                <span id="linearConnectionStatus">Connect Linear</span>
            </button>
        </header>

        <main>
            <section class="form-section">
                <h2>CHOW Information</h2>
                <form id="chow-form">
                    <!-- Customer Information -->
                    <fieldset>
                        <legend>Customer Information</legend>

                        <div class="form-group">
                            <label for="oldOwnerName">Old Owner Name *</label>
                            <input type="text" id="oldOwnerName" name="oldOwnerName" required
                                   placeholder="e.g., ABC Healthcare LLC">
                        </div>

                        <div class="form-group">
                            <label for="newOwnerName">New Owner Name *</label>
                            <input type="text" id="newOwnerName" name="newOwnerName" required
                                   placeholder="e.g., XYZ Senior Care Inc">
                        </div>

                        <div class="form-group">
                            <label for="affectedFacilities">Affected Facilities (Old Names) *</label>
                            <textarea id="affectedFacilities" name="affectedFacilities" required
                                      placeholder="List each facility on a new line&#10;e.g., Sunrise Nursing Home&#10;Valley Care Center"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="newFacilityNames">New Facility Names (if rebranded)</label>
                            <textarea id="newFacilityNames" name="newFacilityNames"
                                      placeholder="Leave blank if names stay the same&#10;Otherwise, list new names in same order as above&#10;e.g., Riverside Nursing Home&#10;Riverside Care Center"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="newOwnerContact">New Owner Contact Info</label>
                            <textarea id="newOwnerContact" name="newOwnerContact"
                                      placeholder="Phone: 555-123-4567&#10;Email: ap@newowner.com"></textarea>
                        </div>
                    </fieldset>

                    <!-- Timing -->
                    <fieldset>
                        <legend>Timing</legend>

                        <div class="form-group">
                            <label for="acquisitionDate">Acquisition Date *</label>
                            <input type="date" id="acquisitionDate" name="acquisitionDate" required>
                            <span class="helper-text" id="timingIndicator"></span>
                        </div>
                    </fieldset>

                    <!-- Sale Details -->
                    <fieldset>
                        <legend>Sale Details</legend>

                        <div class="form-group">
                            <label for="saleType">Sale Type *</label>
                            <select id="saleType" name="saleType" required>
                                <option value="">-- Select --</option>
                                <option value="asset">Asset Sale (old owner keeps debt)</option>
                                <option value="stock">Stock Sale (new owner assumes debt)</option>
                                <option value="unknown">Unknown / Not Sure</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="contractSigned">Is a New Contract Signed? *</label>
                            <select id="contractSigned" name="contractSigned" required>
                                <option value="">-- Select --</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                                <option value="unknown">I don't know</option>
                            </select>
                        </div>
                    </fieldset>

                    <!-- Financial Status -->
                    <fieldset>
                        <legend>Financial Status</legend>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="outstandingAR">Outstanding AR? *</label>
                                <select id="outstandingAR" name="outstandingAR" required>
                                    <option value="">-- Select --</option>
                                    <option value="yes">Yes (>$0 owed)</option>
                                    <option value="no">No ($0 outstanding)</option>
                                </select>
                            </div>

                            <div class="form-group half">
                                <label for="futureBookedShifts">Future Booked Shifts? *</label>
                                <select id="futureBookedShifts" name="futureBookedShifts" required>
                                    <option value="">-- Select --</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="financialDistress">Signals of Financial Distress?</label>
                                <select id="financialDistress" name="financialDistress">
                                    <option value="unknown">Unknown</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>

                            <div class="form-group half">
                                <label for="willingnessToPay">Willingness to Pay?</label>
                                <select id="willingnessToPay" name="willingnessToPay">
                                    <option value="unknown">Unknown</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Special Cases -->
                    <fieldset>
                        <legend>Special Cases</legend>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="blacklisted">Is Either Party Blacklisted?</label>
                                <select id="blacklisted" name="blacklisted">
                                    <option value="none">No</option>
                                    <option value="old">Old Owner is Blacklisted</option>
                                    <option value="new">New Owner is Blacklisted</option>
                                    <option value="both">Both are Blacklisted</option>
                                </select>
                            </div>

                            <div class="form-group half">
                                <label for="badDebt">Is Account in Bad Debt?</label>
                                <select id="badDebt" name="badDebt">
                                    <option value="no">No</option>
                                    <option value="yes">Yes (Handled by Internet Bad Debts)</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Generate Action Plan</button>
                        <button type="button" class="btn-secondary" id="clearForm">Clear Form</button>
                    </div>
                </form>
            </section>

            <section class="output-section" id="outputSection" style="display: none;">
                <div class="output-header">
                    <h2>Action Plan</h2>
                    <div class="output-actions">
                        <button class="btn-copy" id="copyAllBtn" title="Copy everything to clipboard">
                            Copy All
                        </button>
                        <button class="btn-linear" id="createLinearIssue" title="Create Linear issue with all tasks">
                            + Linear
                        </button>
                    </div>
                </div>

                <!-- Risk Assessment -->
                <div class="risk-card" id="riskCard">
                    <div class="risk-level" id="riskLevel">HIGH</div>
                    <div class="scenario" id="scenario"></div>
                    <div class="key-focus" id="keyFocus"></div>
                </div>

                <!-- Disclaimer -->
                <div class="disclaimer">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <text x="8" y="12" text-anchor="middle" font-size="10" font-weight="bold">!</text>
                    </svg>
                    <span>This tool provides guidance based on the information entered. Use your judgment and escalate to <strong>Louis Case</strong> or <strong>Charlie Eikenberg</strong> if the situation is unclear or unusual.</span>
                </div>

                <!-- Priority Actions -->
                <div class="priority-actions" id="priorityActions">
                    <h3>Priority Actions</h3>
                    <ol id="priorityList"></ol>
                </div>

                <!-- Staged Checklist -->
                <div class="staged-checklist" id="stagedChecklist">
                    <div class="stage" id="stage1">
                        <div class="stage-header">
                            <h3>Stage 1: Pre-Outreach</h3>
                            <button class="btn-copy-stage" data-stage="stage1" title="Copy this stage">Copy</button>
                        </div>
                        <ul class="checklist"></ul>
                    </div>
                    <div class="stage" id="stage2">
                        <div class="stage-header">
                            <h3>Stage 2: Outreach</h3>
                            <button class="btn-copy-stage" data-stage="stage2" title="Copy this stage">Copy</button>
                        </div>
                        <ul class="checklist"></ul>
                    </div>
                    <div class="stage" id="stage3">
                        <div class="stage-header">
                            <h3>Stage 3: Post-Outreach</h3>
                            <button class="btn-copy-stage" data-stage="stage3" title="Copy this stage">Copy</button>
                        </div>
                        <ul class="checklist"></ul>
                    </div>
                    <div class="stage" id="stage4">
                        <div class="stage-header">
                            <h3>Stage 4: Continuous</h3>
                            <button class="btn-copy-stage" data-stage="stage4" title="Copy this stage">Copy</button>
                        </div>
                        <ul class="checklist"></ul>
                    </div>
                </div>

                <!-- Special Alerts -->
                <div class="special-alerts" id="specialAlerts" style="display: none;">
                    <h3>Special Considerations</h3>
                    <ul id="alertsList"></ul>
                </div>
            </section>
        </main>

        <footer>
            <p>Clipboard Health - Billing Team Tool</p>
        </footer>
    </div>

    <!-- Linear Settings Modal -->
    <div class="modal-overlay" id="linearSettingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Linear Integration Settings</h3>
                <button class="modal-close" id="closeLinearSettings">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">
                    Connect to Linear to create issues directly from this tool.
                    <a href="https://linear.app/settings/api" target="_blank">Get your API key here</a>.
                </p>

                <div class="form-group">
                    <label for="linearApiKey">Linear API Key</label>
                    <input type="password" id="linearApiKey" placeholder="lin_api_xxxxxxxxxxxxx">
                </div>

                <div class="form-group" id="teamSelectGroup" style="display: none;">
                    <label for="linearTeam">Team</label>
                    <select id="linearTeam">
                        <option value="">Loading teams...</option>
                    </select>
                </div>

                <div class="form-group" id="projectSelectGroup" style="display: none;">
                    <label for="linearProject">Project (optional)</label>
                    <select id="linearProject">
                        <option value="">No project</option>
                    </select>
                </div>

                <div class="linear-status" id="linearStatus"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="disconnectLinear" style="display: none;">Disconnect</button>
                <button class="btn-primary" id="saveLinearSettings">Connect to Linear</button>
            </div>
        </div>
    </div>

    <!-- Create Issue Modal -->
    <div class="modal-overlay" id="createIssueModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Linear Issue</h3>
                <button class="modal-close" id="closeCreateIssue">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="issueTitle">Title</label>
                    <input type="text" id="issueTitle" placeholder="CHOW: Old Owner â†’ New Owner">
                </div>

                <div class="form-group">
                    <label for="issuePriority">Priority</label>
                    <select id="issuePriority">
                        <option value="">No priority</option>
                        <option value="1">Urgent</option>
                        <option value="2">High</option>
                        <option value="3">Medium</option>
                        <option value="4">Low</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="issueAssignee">Assignee</label>
                    <select id="issueAssignee">
                        <option value="">Unassigned</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="issueStatus">Status</label>
                    <select id="issueStatus">
                        <option value="">Default</option>
                    </select>
                </div>

                <div class="linear-status" id="createIssueStatus"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelCreateIssue">Cancel</button>
                <button class="btn-primary" id="confirmCreateIssue">Create Issue</button>
            </div>
        </div>
    </div>

    <!-- Toast notification for copy -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <script src="decision-engine.js"></script>
    <script src="app.js"></script>
    <script src="linear-integration.js"></script>
</body>
</html>
